!function(){var i="function"==typeof require?require("alloyfinger"):window.AlloyFinger,e="function"==typeof require?require("css3transform"):window.Transform,t=function(t){if(this.renderTo=document.body,this.canvas=document.createElement("canvas"),this.output=t.output,this.width=t.width,this.height=t.height,this.canvas.width=t.width*this.output,this.canvas.height=t.height*this.output,this.circle=t.circle,t.width!==t.height&&t.circle)throw"can't set circle to true when width is not equal to height";this.ctx=this.canvas.getContext("2d"),this.croppingBox=document.createElement("div"),this.croppingBox.style.visibility="hidden",this.cover=document.createElement("canvas"),this.type=t.type||"png",this.cover.width=window.innerWidth,this.cover.height=window.innerHeight,this.cover_ctx=this.cover.getContext("2d"),this.img=document.createElement("img"),"http"===t.image_src.substring(0,4).toLowerCase()&&(this.img.crossOrigin="anonymous"),this.cancel=t.cancel,this.ok=t.ok,this.ok_text=t.ok_text||"ok",this.cancel_text=t.cancel_text||"cancel",this.croppingBox.appendChild(this.img),this.croppingBox.appendChild(this.cover),this.renderTo.appendChild(this.croppingBox),this.img.onload=this.init.bind(this),this.img.src=t.image_src,this.cancel_btn=document.createElement("a"),this.cancel_btn.innerHTML=this.cancel_text,this.ok_btn=document.createElement("a"),this.ok_btn.innerHTML=this.ok_text,this.croppingBox.appendChild(this.ok_btn),this.croppingBox.appendChild(this.cancel_btn)};t.prototype={init:function(){this.img_width=this.img.width,this.img_height=this.img.height,e(this.img,!0);var t=window.innerWidth/this.img_width;window.innerHeight,this.img_height;this.initScale=t,this.originScale=t,this.img.scaleX=this.img.scaleY=t,this.first=1;var l=this;new i(this.croppingBox,{multipointStart:function(t){var i=(t.touches[0].pageX+t.touches[1].pageX)/2,e=(t.touches[0].pageY+t.touches[1].pageY)/2,s=l.img.getBoundingClientRect(),h=i-(s.left+s.width/2),n=e-(s.top+s.height/2),o=l.img.originX,a=l.img.originY;l.img.originX=h/l.img.scaleX,l.img.originY=n/l.img.scaleY,l.img.translateX+=h-o*l.img.scaleX,l.img.translateY+=n-a*l.img.scaleX,1==l.first&&(l.img.scaleX=l.img.scaleY=1.1*l.initScale,++l.first),l.initScale=l.img.scaleX},pinch:function(t){var i=l.img.getBoundingClientRect(),e=(document.documentElement.clientHeight-l.height)/2,s=t.zoom,h=(i.width*s-i.width)/2,n=(i.height-i.height*s)/2;l.initScale*s<=1.6&&l.initscale*s>=l.originScale&&h>=i.left&&-h<=i.right-l.width&&n<=e-i.top&&n<=i.bottom-e-l.height&&(l.img.scalex=l.img.scaley=l.initscale*s)},pressmove:function(t){var i="l.img.getBoundingClientRect(),e=(document.documentElement.clientHeight-l.height)/2;i.left+t.deltaX<=0&&i.right+t.deltaX">=l.width&&(l.img.translateX+=t.deltaX),0<=e-i.top-t.deltay&&i.bottom+t.deltay-e>=l.height&&(l.img.translateY+=t.deltaY),t.preventDefault()}}),new i(this.cancel_btn,{touchStart:function(){l.cancel_btn.style.backgroundColor="#ffffff",l.cancel_btn.style.color="#3B4152"},tap:this._cancel.bind(this)}),new i(this.ok_btn,{touchStart:function(){l.ok_btn.style.backgroundColor="#2bcafd",l.ok_btn.style.color="#ffffff"},tap:this._ok.bind(this)}),document.addEventListener("touchend",function(){l.cancel_btn.style.backgroundColor="#ffffff",l.ok_btn.style.backgroundColor="#2bcafd"}),this.renderCover(),this.setStyle()},_cancel:function(){this._css(this.croppingBox,{display:"none"}),this.cancel()},_ok:function(){this.crop(),this._css(this.croppingBox,{display:"none"}),this.ok(this.canvas.toDataURL("image/"+this.type),this.canvas)},renderCover:function(){var t=this.cover_ctx,i=this.cover.width,e=this.cover.height,s=this.width,h=this.height;t.save(),t.fillStyle="black",t.globalAlpha=.7,t.fillRect(0,0,this.cover.width,this.cover.height),t.restore(),t.save(),t.globalCompositeOperation="destination-out",t.beginPath(),this.circle?t.arc(i/2,e/2,s/2-4,0,2*Math.PI,!1):t.rect(i/2-s/2,e/2-h/2,s,h),t.fill(),t.restore(),t.save(),t.beginPath(),t.strokeStyle="white",this.circle?t.arc(i/2,e/2,s/2-4,0,2*Math.PI,!1):t.rect(i/2-s/2,e/2-h/2,s,h),t.stroke()},setStyle:function(){this._css(this.cover,{position:"fixed",zIndex:"100",left:"0px",top:"0px"}),this._css(this.croppingBox,{color:"white",textAlign:"center",fontSize:"18px",textDecoration:"none",visibility:"visible"}),this._css(this.img,{position:"fixed",zIndex:"99",left:"50%",top:window.innerHeight/2+"px",marginLeft:this.img_width/-2+"px",marginTop:this.img_height/-2+"px"}),this._css(this.ok_btn,{position:"fixed",zIndex:"101",width:"100px",right:"50px",lineHeight:"40px",height:"40px",bottom:"20px",borderRadius:"2px",color:"#ffffff",backgroundColor:"#2bcafd"}),this._css(this.cancel_btn,{position:"fixed",zIndex:"101",width:"100px",height:"40px",lineHeight:"40px",left:"50px",bottom:"20px",borderRadius:"2px",color:"#3B4152",backgroundColor:"#ffffff"})},crop:function(){this.calculateRect(),this.ctx.drawImage(this.img,this.crop_rect[0],this.crop_rect[1],this.crop_rect[2],this.crop_rect[3],0,0,this.crop_rect[2]*this.img.scaleX,this.crop_rect[3]*this.img.scaleY)},calculateRect:function(){var t=this.img.getBoundingClientRect(),i=window.innerWidth/2-this.width/2,e=window.innerHeight/2-this.height/2,s=[i,e,this.width+i,this.height+e],h=[t.left,t.top,t.width+t.left,t.height+t.top],n=this.getOverlap.apply(this,s.concat(h)),o=(n[0]-h[0])/this.img.scaleX,a=(n[1]-h[1])/this.img.scaleY,l=n[2]/this.img.scaleX,c=n[3]/this.img.scaleY;o<0&&(o=0),a<0&&(a=0),o+l>this.img_width&&(l=this.img_width-o),a+c>this.img_height&&(c=this.img_height-a),this.crop_rect=[o,a,l,c]},getOverlap:function(t,i,e,s,h,n,o,a){if(e<h||s<n||o<t||a<i)return[0,0,0,0];var l="Math.max(t,h),c=Math.max(i,n);return[l,c,Math.min(e,o)-l,Math.min(s,a)-c]},_css:function(t,i){for(var" e in i)i.hasownproperty(e)&&(t.style[e]='i[e])}},"undefined"!=typeof' module&&"object"="=typeof" exports?module.exports="t:window.AlloyCrop=t}(),function(){function" r(t){return math.sqrt(t.x*t.x+t.y*t.y)}function p(t,i){var e,s,h=function(t,i){var 0;var s,h,n="(h=i,((s=t).x*h.x+s.y*h.y)/e);return" 1<n&&(n=1),Math.acos(n)}(t,i);return s="i,0<(e=t).x*s.y-s.x*e.y&&(h*=-1),180*h/Math.PI}var" h(t,i){var s(t);return e.add(i),e}s.prototype.add="function(t){this.handlers.push(t)},s.prototype.del=function(t){t||(this.handlers=[]);for(var" i="this.handlers.length;0<=i;i--)this.handlers[i]===t&&this.handlers.splice(i,1)},s.prototype.dispatch=function(){for(var" t="0,i=this.handlers.length;t<i;t++){var" e&&e.apply(this.el,arguments)}};var t?document.queryselector(t):t,this.start='this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;var' n="t.touches[1].pageX,o=t.touches[1].pageY,a={x:t.touches[1].pageX-s,y:t.touches[1].pageY-h};null!==i.x&&(0<this.pinchStartLen&&(t.zoom=r(a)/this.pinchStartLen,this.pinch.dispatch(t,this.element)),t.angle=p(a,i),this.rotate.dispatch(t,this.element)),i.x=a.x,i.y=a.y,null!==this.x2&&null!==this.sx2?(t.deltaX=(s-this.x2+n-this.sx2)/2,t.deltaY=(h-this.y2+o-this.sy2)/2):(t.deltaX=0,t.deltaY=0),this.twoFingerPressMove.dispatch(t,this.element),this.sx2=n,this.sy2=o}else{if(null!==this.x2){t.deltaX=s-this.x2,t.deltaY=h-this.y2;var" t.deltax="0,t.deltaY=0;this.pressMove.dispatch(t,this.element)}this.touchMove.dispatch(t,this.element),this._cancelLongTap(),this.x2=s,this.y2=h,1<e&&t.preventDefault()}},end:function(t){if(t.changedTouches){this._cancelLongTap();var" math.abs(t-i)>=Math.abs(e-s)?0</h||s<n||o<t||a<i)return[0,0,0,0];var></0&&(o=0),a<0&&(a=0),o+l></=e-i.top-t.deltay&&i.bottom+t.deltay-e></=i.right-l.width&&n<=e-i.top&&n<=i.bottom-e-l.height&&(l.img.scalex=l.img.scaley=l.initscale*s)},pressmove:function(t){var></=1.6&&l.initscale*s>